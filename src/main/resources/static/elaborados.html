<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <title>Celulares</title>
    <meta content="" name="description">
    <meta content="" name="keywords">




    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,600;1,700&family=Roboto:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&family=Work+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
        rel="stylesheet">

    <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <link href="assets/vendor/fontawesome-free/css/all.min.css" rel="stylesheet">
    <link href="assets/vendor/aos/aos.css" rel="stylesheet">
    <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
    <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

    <link href="assets/css/main.css" rel="stylesheet">
    <link rel="stylesheet" href="css/admin.css">
</head>

<body>
    <header id="header" class="header d-flex align-items-center">
        <div class="container-fluid container-xl d-flex align-items-center justify-content-between">

            <a href="Admin.html" class="logo d-flex align-items-center">
                <h1><label>MOVILAND</label> <span style="color:rgb(247, 122, 39);">.Admin</span></h1>
            </a>

            <i class="mobile-nav-toggle mobile-nav-show bi bi-list"></i>
            <i class="mobile-nav-toggle mobile-nav-hide d-none bi bi-x"></i>
            <nav id="navbar" class="navbar">
                <ul>
                    <li><a href="index.html">Salir</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main id="main">
        <div class="breadcrumbs d-flex align-items-center"
            style="background-image: url('img/inicio/elaborados-font-main-img.jpg');">
            <div class="container position-relative d-flex flex-column align-items-center" data-aos="fade">

                <h2>Celulares</h2>
                <ol>
                    <li><a href="Admin.html">Productos</a></li>
                    <li>Registro de Celulares</li>
                </ol>

            </div>
        </div><!-- End Breadcrumbs -->

        <!-- ======= Our Projects Section ======= -->
        <!-- <section id="projects" class="container"> -->
        <br>
        <div class="tablita">
            <table class="table" style="text-align: center;">
                <thead class="thead-dark" style="background-color: black">
                    <tr>
                        <th scope="col">No.</th>
                        <th scope="col">Marca</th>
                        <th scope="col">Nombre</th>
                        <th scope="col">Stock</th>
                        <th scope="col">Pantalla</th>
                        <th scope="col">Batería</th>
                        <th scope="col">S.O</th>
                        <th scope="col">Camara</th>
                        <th scope="col">Almacenamiento</th>
                        <th scope="col">Imagen</th>
                        <th scope="col">Precio</th>
                        <th scope="col" colspan="2">Opciones</th>
                    </tr>
                </thead>
                <tbody id="pedidoBody">

                </tbody>
            </table>
        </div>
        <!-- </section>End Our Projects Section -->
        <br><br><br>
    </main><!-- End #main -->

    <!-- ========= Scripts para contenido Diámico ========= -->

    <script>
        let pedidos;  // Declarar pedidos a nivel global

        fetch('http://localhost:8085/api/v1/moviland/celular')
            .then(response => response.json())
            .then(pedidos => {
                // Llenar dinámicamente la tabla de pedidos
                const pedidosContainer = document.getElementById('pedidoBody');

                pedidos.forEach((pedido, index) => {
                    const row = document.createElement('tr');
                    row.classList.add('pedido-row');
                    row.setAttribute('data-id', pedido.id);

                    row.innerHTML = `
                    <td scope="row">${index + 1}</td>
                    <th id="marca">${pedido.marca}</th>
                    <td id="nombre">${pedido.nombre}</td>
                    <td id="stock">${pedido.stock}</td>
                    <td id="pantalla">${pedido.pantalla}</td>
                    <td id="bateria">${pedido.bateria}</td>
                    <td id="sistemaOperativo">${pedido.sistemaOperativo}</td>
                    <td id="camara">${pedido.camara}</td>
                    <td id="almacenamiento">${pedido.almacenamiento}</td>
                    <td id="imagen">${pedido.imagen}</td>
                    <td id="precio">${pedido.precio}</td>
                    <td><svg viewBox="0 0 24 24" fill="#000000" xmlns="http://www.w3.org/2000/svg" onclick="guardarDatos(${pedido.id})"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g id="style=fill"> <g id="edit"> <path id="Subtract" fill-rule="evenodd" clip-rule="evenodd" d="M18.9405 3.12087L21.0618 5.24219C22.2334 6.41376 22.2334 8.31326 21.0618 9.48483L19.2586 11.288L12.8947 4.92403L14.6978 3.12087C15.8694 1.94929 17.7689 1.94929 18.9405 3.12087ZM11.834 5.98469L3.70656 14.1121C3.22329 14.5954 2.91952 15.2292 2.84552 15.9086L2.45151 19.5264C2.31313 20.7969 3.38571 21.8695 4.65629 21.7311L8.27401 21.3371C8.95345 21.2631 9.58725 20.9594 10.0705 20.4761L18.1979 12.3486L11.834 5.98469Z" fill="#000000"></path> </g> </g> </g></svg>
                    </td>
                    <td><svg fill="#000000" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" onclick="eliminarPedido(${pedido.id})"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path d="M17,4V5H15V4H9V5H7V4A2,2,0,0,1,9,2h6A2,2,0,0,1,17,4Z"></path><path d="M20,6H4A1,1,0,0,0,4,8H5.07l.87,12.14a2,2,0,0,0,2,1.86h8.14a2,2,0,0,0,2-1.86L18.93,8H20a1,1,0,0,0,0-2ZM13,17a1,1,0,0,1-2,0V11a1,1,0,0,1,2,0Z"></path></g></svg>                      
                    </td>
                `;

                    pedidosContainer.appendChild(row);

                    // Agregar evento click a las filas recién creadas
                    row.addEventListener('click', function () {
                        row.classList.toggle('selected');
                    });
                });
            })
            .catch(error => console.error('Error al obtener los productos:', error));

        function eliminarPedido(id) {
            fetch(`/api/v1/moviland/celular/${id}`, {
                method: 'DELETE',
            })
                .then(response => {
                    if (response.ok) {
                        const pedidosContainer = document.getElementById('pedidoBody');
                        const rowToDelete = pedidosContainer.querySelector(`.pedido-row[data-id="${id}"]`);
                        if (rowToDelete) {
                            pedidosContainer.removeChild(rowToDelete);
                            alert(`Producto ${id} eliminado con éxito`);
                        } else {
                            alert('Error al eliminar el producto de la interfaz');
                        }
                    } else {
                        alert('Error al eliminar el producto en el servidor');
                    }
                })
                .catch(error => console.error('Error al eliminar el producto:', error));
        }

        function guardarDatos(id) {

            let eliminar = id;

            const filaSeleccionada = document.querySelector('.pedido-row.selected');

            if (filaSeleccionada) {
                const idCel = filaSeleccionada.getAttribute('data-id');
                const marca = filaSeleccionada.querySelector('#marca').innerText;
                const nombre = filaSeleccionada.querySelector('#nombre').innerText;
                const stock = filaSeleccionada.querySelector('#stock').innerText;
                const pantalla = filaSeleccionada.querySelector('#pantalla').innerText;
                const bateria = filaSeleccionada.querySelector('#bateria').innerText;
                const sistemaOperativo = filaSeleccionada.querySelector('#sistemaOperativo').innerText;
                const camara = filaSeleccionada.querySelector('#camara').innerText;
                const almacenamiento = filaSeleccionada.querySelector('#almacenamiento').innerText;
                const imagen = filaSeleccionada.querySelector('#imagen').innerText;
                const precio = filaSeleccionada.querySelector('#precio').innerText;

                // Crear un objeto con los datos de la fila
                const datosFila = {
                    id: idCel,
                    marca: marca,
                    nombre: nombre,
                    stock: stock,
                    pantalla: pantalla,
                    bateria: bateria,
                    sistemaOperativo: sistemaOperativo,
                    camara: camara,
                    almacenamiento: almacenamiento,
                    imagen: imagen,
                    precio: precio
                };

                // Guardar los datos en la memoria local
                const datosGuardados = JSON.parse(localStorage.getItem('datosGuardados')) || [];
                const indiceExistente = datosGuardados.findIndex(item => item.id === id);

                if (indiceExistente !== -1) {
                    // Si ya existe en la memoria local, reemplazar los datos existentes
                    datosGuardados[indiceExistente] = datosFila;
                } else {
                    // Si no existe, agregar nuevos datos
                    datosGuardados.push(datosFila);
                }

                localStorage.setItem('datosGuardados', JSON.stringify(datosGuardados));

                // alert('Datos de la fila guardados localmente.');
                console.log(datosFila);
                window.location.href = 'editar.html';
            } else {
                alert('Selecciona una fila antes de guardar los datos.');
            }
        }

        // Agregar evento click a las filas para seleccionarlas/deseleccionarlas
        document.addEventListener('click', function (event) {
            if (event.target && event.target.tagName === 'TR' && event.target.classList.contains('pedido-row')) {
                event.target.classList.toggle('selected');
            }
        });

    </script>

    <!-- ======= Footer ======= -->
    <footer class="fotfot">
        <div class="footerter-content">
            <div class="logotipopo-footer">
                <a class="logotipopo" href="index.html">Movi-Land</a>
            </div>
            <div class="derecho-reservado">
                Todos los derechos reservados ©
            </div>
        </div>
        <div class="grupo">
            Grupo Web
        </div>
    </footer>
    <!-- End Footer -->

    <a href="#" class="scroll-top d-flex align-items-center justify-content-center"><i
            class="bi bi-arrow-up-short"></i></a>

    <div id="preloader"></div>

    <!-- Vendor JS Files -->
    <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/vendor/aos/aos.js"></script>
    <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
    <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
    <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
    <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>
    <script src="assets/vendor/php-email-form/validate.js"></script>

    <!-- Template Main JS File -->
    <script src="assets/js/main.js"></script>

</body>

</html>